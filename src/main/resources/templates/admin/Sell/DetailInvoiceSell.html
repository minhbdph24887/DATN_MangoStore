<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml" th:replace="~{/layout/admin/IndexAdmin :: dynamic(~{:: main})}">

<body>
<main class="indexSell checkNumberPhonePage checkVoucherPage addProductDetail updateQuantityInvoiceDetail checkInfoMoneyPage updateStatusInvoice">
    <div>
        <ul class="breadcrumb">
            <li class="breadcrumb-item"><a th:href="@{/mangostore/admin/sell}">Index Sell</a></li>
            <li class="breadcrumb-item active" aria-current="page">Detail Sell</li>
        </ul>
    </div>
    <div class="row">
        <div class="col-lg-12 grid-margin stretch-card">
            <div class="card">
                <div class="card-body">
                    <h3>Sales At The Counter</h3>
                    <div class="row">
                        <div class="col-md-6">
                            <a type="button" id="createOrderButton" class="btn btn-success"
                               style="width: 126px;">Create Order *</a>
                            <span style="font-size: 15px; line-height: 1.5; padding: 5px 10px; color: red">* You only create a maximum of 5 invoices</span>
                            <br>
                            <th:block th:each="listInvoiceByAccount : ${listInvoiceByAccount}">
                                <a type="button" class="btn btn-outline-secondary"
                                   th:classappend="${idInvoice == listInvoiceByAccount.id ? 'active' : ''}"
                                   th:href="@{/mangostore/admin/sell/edit(id=${listInvoiceByAccount.id})}">
                                    <tr>
                                        <td class="align-middle" th:text="${listInvoiceByAccount.nameInvoice}"></td>
                                    </tr>
                                </a>
                            </th:block>
                            <form th:action="@{/mangostore/admin/sell/delete}" method="post">
                                <input type="hidden" name="id" th:value="${detailInvoice.id}"/>
                                <button type="submit" class="btn btn-danger"
                                        style="padding: 5px 10px;font-size: 12px;line-height: 1.5;">Cancel Invoice
                                </button>
                            </form>
                        </div>
                        <div class="col-md-6">
                            <form th:action="@{/mangostore/admin/sell/update-client}" method="post"
                                  style="height: 54px;">
                                <div class="form-group d-flex">
                                    <input type="hidden" id="idInvoiceInputNumber" th:value="${detailInvoice.id}"/>
                                    <select class="select2-search-example form-control form-control-full"
                                            id="optionClient">
                                        <option value="">Select Client</option>
                                        <option value="add">
                                            <i class="bi bi-cloud-plus"></i>Add Client
                                        </option>
                                        <option th:each="listAccount : ${listAccount}" th:value="${listAccount.id}"
                                                th:text="${listAccount.fullName +  ' - '  + listAccount.numberPhone}"></option>
                                    </select>
                                    <button class="btn btn-success"
                                            style="padding: 5px 10px;font-size: 12px;line-height: 1.5;" type="button"
                                            onclick="updateClient()">
                                        Apply
                                    </button>
                                </div>
                            </form>
                            <th:block th:if="${nameClient != null and pointClient != null}">
                                <form th:action="@{/mangostore/admin/sell/update-point}" method="post">
                                    <div class="form-group d-flex">
                                        <div class="flex-column">
                                            <input type="hidden" name="id" th:value="${detailInvoice.id}"/>
                                            <input type="hidden" name="point" th:value="${pointClient}">
                                            <input type="text" class="form-control me-2"
                                                   th:value="${'fullName:' + nameClient + ',  customerPoints:' + pointClient}"
                                                   readonly style="width: 664px">
                                            <span>1 point = 1.000 VND</span>
                                        </div>
                                        <button class="btn btn-info" type="submit">Apply</button>
                                    </div>
                                </form>
                            </th:block>
                            <th:block th:unless="${nameClient != null and pointClient != null}">
                                <div class="form-group d-flex">
                                    <input type="text" class="form-control" value="No data" readonly>
                                </div>
                            </th:block>
                            <div class="form-group d-flex">
                                <input type="hidden" id="idInvoiceInput" name="id" th:value="${detailInvoice.id}">
                                <select name="voucher" id="voucherSelect" class="form-control" style="height: 47px;">
                                    <option value="">Ch·ªçn Voucher</option>
                                    <option th:each="listVoucherClient : ${listVoucherClient}"
                                            th:value="${listVoucherClient.id}"
                                            th:text="${listVoucherClient.nameVoucher + '( ' + #numbers.formatDecimal(listVoucherClient.reducedValue, 0, 'COMMA', 0, 'POINT') + ' VND )'}"></option>
                                </select>
                                <button type="button" class="btn btn-success" onclick="updateVoucherForSell()">Apply</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-7 grid-margin stretch-card">
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-12">
                            <button type="button" class="btn btn-info btn-lg" data-toggle="modal"
                                    data-target="#addProductDetail"
                                    style=" padding: 5px 10px;font-size: 12px;line-height: 1.5;">Add Product Detail
                            </button>
                        </div>
                        <div class="col-md-12">
                            <div class="table-responsive">
                                <div class="header">
                                    <table class="table table-striped">
                                        <thead>
                                        <tr>
                                            <th style="width: 30px">#</th>
                                            <th style="width: 117px">NameProduct</th>
                                            <th style="width: 139px">Quantity</th>
                                            <th style="width: 130px">Price</th>
                                            <th style="width: 80px">Action</th>
                                        </tr>
                                        </thead>
                                    </table>
                                </div>
                                <div class="content" style="height: 245px">
                                    <table class="table table-hover">
                                        <tbody>
                                        <tr th:each="listInvoiceDetail, stat : ${listInvoiceDetail}">
                                            <td style="width: 30px" th:text="${stat.count}"></td>
                                            <td style="width: 117px"
                                                th:text="${listInvoiceDetail.productDetail.product.nameProduct + '(' + listInvoiceDetail.productDetail.size.nameSize + ', ' + listInvoiceDetail.productDetail.color.nameColor + ')'}"></td>
                                            <td style="width: 139px">
                                                <div class="input-group quantity mx-auto" style="width: 145px;">
                                                    <div class="input-group-btn">
                                                        <button type="button" class="reduce"
                                                                th:attr="onclick='reduceQuantity(' + ${listInvoiceDetail.id} + ')'">
                                                            -
                                                        </button>
                                                    </div>
                                                    <input type="text"
                                                           style="height: 24px; width: 80px; margin-top: 4px"
                                                           th:value="${listInvoiceDetail.quantity}" readonly/>
                                                    <div class="input-group-btn">
                                                        <button type="button" class="increase"
                                                                th:attr="onclick='increaseQuantity(' + ${listInvoiceDetail.id} + ')'">
                                                            +
                                                        </button>
                                                    </div>
                                                </div>
                                            </td>
                                            <td style="width: 130px"
                                                th:text="${#numbers.formatDecimal(listInvoiceDetail.price, 0, 'COMMA', 0, 'POINT') + ' VND'}"></td>
                                            <td style="width: 80px">
                                                <form th:action="@{/mangostore/admin/sell/delete-product}"
                                                      method="post">
                                                    <input type="hidden" name="id" th:value="${listInvoiceDetail.id}">
                                                    <button type="submit" class="btn btn-danger">
                                                        Delete
                                                    </button>
                                                </form>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-5 grid-margin stretch-card">
            <div class="card">
                <div class="card-body">
                    <h5>Invoice information</h5>
                    <div class="form-horizontal">
                        <div class="form-group" style="display: flex; align-items: center;">
                            <label class="control-label col-sm-5" style="margin: 0;">CodeInvoice:</label>
                            <div class="col-sm-7" style="margin: 0;">
                                <p class="form-control-static" th:text="${detailInvoice.codeInvoice}"
                                   style="margin: 0; color: red"></p>
                            </div>
                        </div>
                        <div class="form-group" style="display: flex; align-items: center;">
                            <label class="control-label col-sm-5" style="margin: 0;">NameInvoice:</label>
                            <div class="col-sm-7" style="margin: 0;">
                                <p class="form-control-static" th:text="${detailInvoice.nameInvoice}"
                                   style="margin: 0; color: red"></p>
                            </div>
                        </div>
                        <div class="form-group" style="display: flex; align-items: center;">
                            <label class="control-label col-sm-5" style="margin: 0;">DateCreateInvoice:</label>
                            <div class="col-sm-7" style="margin: 0;">
                                <p class="form-control-static"
                                   th:text="${#temporals.format(detailInvoice.invoiceCreationDate, 'HH:mm:ss : dd/MM/yyyy')}"
                                   style="margin: 0; color: red"></p>
                            </div>
                        </div>
                        <div class="form-group" style="display: flex; align-items: center;">
                            <label class="control-label col-sm-5" style="margin: 0;">ConversionPoint:</label>
                            <th:block th:if="${detailInvoice.customerPoints != null}">
                                <div class="col-sm-7" style="margin: 0;">
                                    <p class="form-control-static"
                                       th:text="${#numbers.formatDecimal(customerPoints, 0, 'COMMA', 0, 'POINT') + ' VND'}"
                                       style="margin: 0; color: red"></p>
                                </div>
                            </th:block>
                            <th:block th:unless="${detailInvoice.customerPoints != null}">
                                <div class="col-sm-7" style="margin: 0;">
                                    <p class="form-control-static"
                                       style="margin: 0; color: red">0 VND</p>
                                </div>
                            </th:block>
                        </div>
                        <div class="form-group" style="display: flex; align-items: center;">
                            <label class="control-label col-sm-5" style="margin: 0;">Voucher:</label>
                            <th:block th:if="${detailInvoice.voucher != null}">
                                <div class="col-sm-7" style="margin: 0;">
                                    <p class="form-control-static"
                                       th:text="${#numbers.formatDecimal(discountVouchers, 0, 'COMMA', 0, 'POINT') + ' VND'}"
                                       style="margin: 0; color: red"></p>
                                </div>
                            </th:block>
                            <th:block th:unless="${detailInvoice.voucher != null}">
                                <div class="col-sm-7" style="margin: 0;">
                                    <p class="form-control-static"
                                       style="margin: 0; color: red">0 VND</p>
                                </div>
                            </th:block>
                        </div>
                        <div class="form-group" style="display: flex; align-items: center;">
                            <label class="control-label col-sm-5" style="margin: 0;">Total Amount:</label>
                            <th:block th:if="${detailInvoice.totalInvoiceAmount != null}">
                                <div class="col-sm-7" style="margin: 0;">
                                    <p class="form-control-static"
                                       th:text="${#numbers.formatDecimal(totalInvoice, 0, 'COMMA', 0, 'POINT') + ' VND'}"
                                       style="margin: 0; color: red"></p>
                                </div>
                            </th:block>
                            <th:block th:unless="${detailInvoice.totalInvoiceAmount != null}">
                                <div class="col-sm-7" style="margin: 0;">
                                    <p class="form-control-static"
                                       style="margin: 0; color: red">0 VND</p>
                                </div>
                            </th:block>
                        </div>
                        <div class="form-group" style="display: flex; align-items: center;">
                            <label class="control-label col-sm-5" style="margin: 0;">Total Payment:</label>
                            <th:block th:if="${detailInvoice.totalPayment != null}">
                                <div class="col-sm-7" style="margin: 0;">
                                    <p class="form-control-static"
                                       th:text="${#numbers.formatDecimal(totalPayment, 0, 'COMMA', 0, 'POINT') + ' VND'}"
                                       style="margin: 0; color: red"></p>
                                </div>
                            </th:block>
                            <th:block th:unless="${detailInvoice.totalPayment != null}">
                                <div class="col-sm-7" style="margin: 0;">
                                    <p class="form-control-static"
                                       style="margin: 0; color: red">0 VND</p>
                                </div>
                            </th:block>
                        </div>
                        <div class="form-group" style="display: flex; align-items: center;">
                            <div class="col-sm-6" style="margin: 0;">
                                <a type="button" th:href="@{/mangostore/admin/sell/banking(id=${detailInvoice.id})}"
                                   class="btn btn-info"
                                   style="padding: 5px 10px;font-size: 12px;line-height: 1.5;">BankTransfer With
                                    VnPAY</a>
                            </div>
                            <div class=" col-sm-6" data-toggle="modal"
                                 data-target="#cashPayment" style="margin: 0;">
                                <button type="button" class="btn btn-success"
                                        style="padding: 5px 10px;font-size: 12px;line-height: 1.5;">CashPayment
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="addClient" role="dialog">
        <div class="modal-dialog modal-fullscreen"
             style="max-width: 100%; margin: 29px 314px 0 314px; padding: 0 0 0 0;">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Add Client</h4>
                </div>
                <div class="modal-body">
                    <div class="container row">
                        <div class="from-group">
                            <label>Name Client:</label>
                            <input type="text" id="nameClientInput" class="form-control">
                        </div>
                        <div class="col-md-6">
                            <div class="from-group">
                                <label>Number Client:</label>
                                <input type="text" id="numberClientInput" class="form-control">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="from-group">
                                <label>Email Client:</label>
                                <input type="text" id="emailClientInput" class="form-control">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" style="height: 82px;">
                    <input type="hidden" id="id-invoice">
                    <button type="button" class="btn btn-outline-secondary" onclick="clearFrom()">Clear</button>
                    <button type="button" class="btn btn-outline-success" onclick="addClient()">
                        <i class="bi bi-check2-circle"></i>
                        Add Client
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="addProductDetail" role="dialog">
        <div class="modal-dialog modal-fullscreen" style="max-width: 100%;margin: 16px 0 0 20px;padding: 0 0 0 0;">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Add Product</h4>
                    <button type="button" class="btn-close" data-dismiss="modal"
                            onclick="window.location.reload();"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <div class="header">
                            <table class="table table-striped">
                                <thead>
                                <tr>
                                    <th style="width: 30px">#</th>
                                    <th style="width: 100px">ImagesProduct</th>
                                    <th style="width: 90px">NameProduct</th>
                                    <th style="width: 70px">QuantityProduct</th>
                                    <th style="width: 55px">Price</th>
                                    <th style="width: 125px">QuantityNew</th>
                                    <th style="width: 80px">Action</th>
                                </tr>
                                </thead>
                            </table>
                        </div>
                        <div class="content" style="height: 660px">
                            <table class="table table-hover">
                                <tbody>
                                <tr th:each="listProductDetail, stat : ${listAllProductDetail}">
                                    <input type="hidden" name="idInvoice"
                                           th:id="${'idInvoiceForAddProduct' + listProductDetail.id}"
                                           th:value="${detailInvoice.id}">
                                    <input type="hidden" name="idProductDetail"
                                           th:id="${'idProductDetailForSell' + listProductDetail.id}"
                                           th:value="${listProductDetail.id}">
                                    <td style="width: 30px" th:text="${stat.count}"></td>
                                    <td style="width: 100px">
                                        <img th:src="@{|/images/product/${listProductDetail.product.images.imagesFile}|}"
                                             alt="image" style="width: 116px; height: 132px">
                                    </td>
                                    <td style="width: 90px; word-break: break-all"
                                        th:text="${listProductDetail.product.nameProduct + '(' + listProductDetail.size.nameSize + ', ' + listProductDetail.color.nameColor + ')'}"></td>
                                    <td style="width: 70px"
                                        th:text="${listProductDetail.quantity + ' pcs'}"></td>
                                    <td style="width: 55px"
                                        th:text="${#numbers.formatDecimal(listProductDetail.price, 0, 'COMMA', 0, 'POINT') + ' VND'}"></td>
                                    <td style="width: 125px">
                                        <div class="form-group">
                                            <input type="number" class="form-control" name="quantityNew"
                                                   th:id="${'quantityNewInput' + listProductDetail.id}">
                                        </div>
                                    </td>
                                    <td style="width: 80px">
                                        <button type="button" class="btn btn-info" th:data-id="${listProductDetail.id}"
                                                onclick="AddProductDetail(this)">
                                            <i class="bi bi-plus-circle-fill">Add</i>
                                        </button>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal"
                            onclick="window.location.reload();">Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="cashPayment" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <form id="formatInput" method="post">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="form-label">ReturnClientMoney</label>
                                    <input type="hidden" name="id" id="idInvoice" th:value="${detailInvoice.id}">
                                    <input type="hidden" id="totalPayment" th:value="${detailInvoice.totalPayment}">
                                    <input type="text" class="form-control"
                                           placeholder="Enter Return Client Money"
                                           id="currencyInput"
                                           oninput="onInput(this.value)">
                                    <input type="hidden" name="returnClientMoney" id="output"/>
                                    <input type="hidden" id="convert"/>
                                    <br>
                                    <div class="form-group" style="display: flex; align-items: center;">
                                        <label class="control-label col-sm-4" style="margin: 0;">Remaining
                                            Money:</label>
                                        <div class="col-sm-8" style="margin: 0;">
                                            <p class="form-control-static" id="remainingMoney"
                                               style="margin: 0; color: red"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="form-group">
                                    <button type="button" class="btn btn-default"
                                            data-dismiss="modal"
                                            style="padding: 5px 10px;font-size: 12px;line-height: 1.5;">Close
                                    </button>
                                    <button type="submit"
                                            id="saveButton" onclick="updateInvoiceStatusSell()"
                                            class="btn btn-primary"
                                            style="padding: 5px 10px;font-size: 12px;line-height: 1.5;">Pay
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</main>
</body>

</html>